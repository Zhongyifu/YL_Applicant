// pages/register/firstPage/register.js
Page({

  /**
   * 页面的初始数据
   */
  data: {
    phone: '',
    securityCode: 1234,
    isSend: false, //验证码是否已经发送
    isPass: true, //是否通过了验证
    phoneTip: '', //当手机号码验证出错时的提示
    keyCodeTip: '', //同理
    keyCodeBtn: '获取验证码', //显示在获取验证码按钮上的文字
  },
  //装填手机号
  phoneInput: function(e) {
    let _that = this;
    _that.setData({
      phone: e.detail.value
    });
  },

  //装填验证码
  keyCodeInput: function(e) {
    let _that = this;
    _that.setData({
      keyCode: e.detail.value
    });
  },

  //获取验证码
  getCode: function(e) {
    let _that = this,
      runTime = 60;
    //发起请求，当成功发送了验证码之后设置在60S之后才能再次获取
    let timer = setInterval(function() {
      if (runTime > 1) {
        runTime--;
        _that.setData({
          keyCodeBtn: runTime + 's',
          isSend: true,
        });
      } else {
        _that.setData({
          keyCodeBtn: '获取验证码',
          isSend: false,
        });
        clearInterval(timer)
      }
    }, 1000);
  },

  //表单提交
  registerForm: function(e) {
    let _that = this;
    console.log('form发生了submit事件，携带数据为：', e.detail.value)

    //验证手机号
    let phoneReg = /^13[\d]{9}$|^14[5,7]{1}\d{8}$|^15[^4]{1}\d{8}$|^17[0,3,6,7,8]{1}\d{8}$|^18[\d]{9}$/,
      phoneNumber = e.detail.value.phone,
      keyCode = e.detail.value.code;
    if (phoneNumber.length == 0) {
      _that.setData({
        phoneTip: '手机号码不能为空!',
        isPass: false
      });
    } else if (!phoneReg.test(phoneNumber)) {
      _that.setData({
        phoneTip: '请输入正确的手机号码!',
        isPass: false
      });
    } else {
      _that.setData({
        phone: phoneNumber,
        phoneTip: '',
        isPass: true
      });
    }

    //验证获得的验证码
    if (keyCode.length == 0) {
      _that.setData({
        keyCodeTip: '验证码不能为空!',
        isPass: false
      });
    } else {
      _that.setData({
        keyCodeTip: '',
        securityCode: keyCode,
        isPass: true
      });
    }

    console.log(_that.data.keyCodeTip);
  }
})